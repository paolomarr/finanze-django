{% extends 'movimenti/base.html' %}
{% load static %}
{% load i18n %}
{% load django_bootstrap5 %}
{% block extra_script %}
{{ block.super }}
<script type="text/javascript" src="{% static 'movimenti/scripts.js' %}"></script>
<script type="text/javascript" src="{% static 'movimenti/assets.js' %}"></script>
{% endblock %}
{% block title %}
Registra bilancio corrente
{% endblock %}
{% block content %}
<div class="row">
	<div class="col col-12 col-md-6">
		<form action="/movimenti/assets" method="post" id="assetsForm">
	{% csrf_token %}
	{% bootstrap_form form exclude='notes,user' %}
	<div class="mb-3">
		<div id="itemsList">
			<div class="row gx-3 d-none" id="balanceListItemTemplate">
				<div class="col col-4"><input class="form-control" type="number" step="0.01" name="balance_item_val" onChange="computeSum()"/></div>
				<div class="col col-6"><input class="form-control" type="text" placeholder="{% translate 'description' %}" name="balance_item_key" onChange="keyItemChange(this)" /></div>
				<div class="col col-2">
					<button type="button" onClick="removeButtonClick(this)" class="col btn btn-light btn-sm remove-button">
						<span class="d-none d-lg-block">Remove</span><span class="d-lg-none"><i class="bi bi-trash"></i></span>
					</button>
				</div>
			</div>
			{% for item in latests %}
			<div class="row gx-3" id="balance_item_{{forloop.counter0}}">
				<div class="col col-4"><input class="form-control" type="number" step="0.01" name="balance_item_val" id="balance_item_val_{{forloop.counter0}}"
						onChange="computeSum()" value="{{item.balance|floatformat:'2u'}}"/></div>
				<div class="col col-6"><input class="form-control" type="text" placeholder="description" name="balance_item_key" id="balance_item_key_{{forloop.counter0}}"
						onChange="keyItemChange(this)" value="{{item.notes}}"/></div>
				<div class="col col-2">
					<button type="button" onClick="removeButtonClick(this)" class="col btn btn-light btn-sm remove-button" data-index="{{forloop.counter0}}">
						<span class="d-none d-lg-block">{% translate "Remove" %}</span><span class="d-lg-none"><i class="bi bi-trash"></i></span>
					</button>
				</div>
			</div>
			{% endfor %}
		</div>
		<div>{% translate "TOTAL" %}: <span id="sum">{{totalassets | floatformat:2}}</span></div>
		<div class="d-flex justify-content-center"><button type="button" id="addbutton" class="btn btn-info btn-sm">{% translate "Add entry" %}</button></div>
	</div>
	{% bootstrap_button button_type="button" content=_("Submit") name="submit" %}
	<!-- <button class="btn btn-primary" type="submit" value="Submit">Registra</button> -->
		</form>
	</div>
</div>
<div class="row">
	<div class="col col-12 col-md-6">
		<div id="messages"></div>
	</div>
</div>
<div class="row">
	<div class="col"><table>
			<thead>
				<tr>
					<th>{% translate "Date" %}</th>
					<th>{% translate "Total" %}</th>
					<th class="lessimportant">{% translate "Error" %}</th>
				</tr>
			</thead>
			<tbody>
				{% for asset in assets %}
				<tr>
					<td>{{asset.date | date:'d/m/Y H:i'}}</td>
					<td>{{asset.totbalance | floatformat:2}}</td>
					<td class="lessimportant">{{asset.error | floatformat:2 }}</td>
				</tr>
				{% endfor %}
			</tbody>
		</table></div>
</div>
{% endblock %}
{% block end_scripts %}
{{ block.super }}
{% endblock %}
