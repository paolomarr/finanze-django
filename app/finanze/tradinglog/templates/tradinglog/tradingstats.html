{% extends 'tradinglog/base.html' %}
{% load static %}
{% load i18n %}
{% block title %}
Trading stats
{% endblock %}
{% block extra_script %}
{{ block.super }}

<script type="text/javascript" src="{% static 'tradinglog/tradingstats.js' %}"></script>
{% endblock %}
{% block content %}
<div class="container">
	<div class="row justify-content-center text-center mt-4"><div class="col-12 col-xl-6 h2">{% translate "Trading assets" %}</div></div>
	<div class="d-none d-xl-block">
		<div class="row border-bottom">
			<div class="table-header col-xl-1">{% translate "Stock" %}</div>
			<div class="table-header col-xl-1">{% translate "Quantity" %}</div>
			<div class="text-end table-header col-xl-2">{% translate "Invested" %}</div>
			<div class="text-end table-header col-xl-2">{% translate "Current val." %} <a href="#" onclick="updateAll()"><i class="bi bi-arrow-clockwise"></i></a></div>
			<div class="table-header col-xl-2">{% translate "Updated" %}</div>
			<div class="text-end table-header col-xl-2">{% translate "Gross" %}</div>
			<div class="text-end table-header col-xl-2">{% translate "Net" %}</div>
		</div>
	</div>
	<div class="d-grid gap-2 d-flex d-xl-none justify-content-center mt-2">
		<button class="btn btn-outline-secondary" type="button" onclick="updateAll()">
			<i class="bi bi-arrow-clockwise"></i> {% translate "Refresh stats" %}
		</button>
	</div>
	{% for stock in tradedStocks %}
	<div class="row border-bottom pt-2 pb-2 align-items-center">
		<div class="col-4 col-xl-1 order-xl-first"><i class="d-xl-none bi bi-shop"></i> <a href="#" data-stock="{{stock.id}}">{{stock.symbol}}</a></div>
		<div class="col-3 col-xl-1 order-xl-1"><i class="d-xl-none bi bi-x"></i> {{stock.quantity}}</div>
		<div class="d-xl-none w-100"></div>
		<div class="col-5 d-xl-none">
			<div class="row">
				<div class="currency col-12"><i class="d-xl-none bi bi-cash-coin"></i> {{stock.amountOrdered | floatformat:2}}</div>
				<div class="currency col-12"><i class="d-xl-none bi bi-graph-up-arrow"></i> {{stock.currentAsset | floatformat:2}}</div>
			</div>
		</div>
		<div class="currency d-none d-xl-flex col-xl-2 order-xl-2">{{stock.amountOrdered | floatformat:2}}</div>
		<div class="currency d-none d-xl-flex col-xl-2 order-xl-3">{{stock.currentAsset | floatformat:2}}</div>
		<div class="col-7 d-xl-none">
			<div class="row">
				<div class="col-12 currency fw-bolder">
					<i class="bi bi-plus-slash-minus"></i> {{stock.currentGrossGain | floatformat:2}} / {{stock.currentNetGain | floatformat:2}}
				</div>
			</div>
		</div>
		<div class="col-12 col-xl-2 order-xl-4" tooltip="{{stock.last_price_update | date:'d/m/Y'}}" data-name="date" data-val="{{stock.last_price_update | date:'Y-m-d'}}"><i class="bi bi-stopwatch d-xl-none"></i> {{stock.last_price_update | timesince}}</div>
		<div class="currency d-none d-xl-flex col-xl-2 order-xl-5">{{stock.currentGrossGain | floatformat:2}}</div>
		<div class="currency d-none d-xl-flex col-xl-2 order-xl-last">{{stock.currentNetGain | floatformat:2}}</div>
	</div>
	{% endfor %}
	<div class="row border-bottom pt-2 pb-2 align-items-center h4">
		<div class="col-12 col-xl-1 h4">{% translate "TOTAL" %}</div>
		<div class="currency d-none d-xl-flex offset-xl-1 col-xl-2">{{totalone | floatformat:2}}</div>
		<div class="currency d-none d-xl-flex col-xl-2">{{totaltwo | floatformat:2}}</div>
		<div class="currency d-none d-xl-flex offset-xl-2 col-xl-2">{{totalthree | floatformat:2}}</div>
		<div class="currency d-none d-xl-flex col-xl-2">{{totalfour | floatformat:2}}</div>
		<div class="col-4 d-xl-none">
			<div class="row">
				<div class="col-12"><i class="d-xl-none bi bi-cash-coin"></i> {{totalone | floatformat:2}}</div>
				<div class="col-12"><i class="d-xl-none bi bi-graph-up-arrow"></i> {{totaltwo | floatformat:2}}
				</div>
			</div>
		</div>
		<div class="col-8 d-xl-none">
			<div class="row">
				<div class="col-12 currency fs-5">
					<i class="bi bi-plus-slash-minus"></i> {{totalthree | floatformat:2}} /
					{{totalfour | floatformat:2}}
				</div>
			</div>
		</div>
	</div>
</div>
<table class="d-none">
	<thead>
		<tr>
			<th>Stock</th>
			<th>Quantity</th>
			<th>Invested</th>
			<th>Current val.</th>
			<th>Updated</th>
			<th colspan="2">GAIN/LOSS</th>
		</tr>
		<tr>
			<th colspan="3"></th>
			<th style="text-align: center;"><a href="#" onclick="updateAll()"><i class="fas fa-sync-alt" id="refresh-spinner"></i></a></th>
			<th></th>
			<th>gross</th>
			<th>net</th>
		</tr>
	</thead>
	<tbody>
		{% for stock in tradedStocks %}
		<tr>
			<td><a href="#" data-stock="{{stock.id}}">{{stock.symbol}}</a></td>
			<td>{{stock.quantity}}</td>
			<td class="currency">{{stock.amountOrdered | floatformat:2}}</td>
			<td class="currency">{{stock.currentAsset | floatformat:2}}</td>
			<td>{{stock.last_price_update | timesince }}</td>
			<td class="currency">{{stock.currentGrossGain | floatformat:2}}</td>
			<td class="currency">{{stock.currentNetGain | floatformat:2}}</td>
		</tr>
		{% endfor %}
		<tr class="table-total">
			<td colspan="2"></td>
			<td class="currency">{{totalone | floatformat:2 }}</td>
			<td class="currency">{{totaltwo | floatformat:2 }}</td>
			<td></td>
			<td><span id="grossgain" class="diff">{{ totalthree | floatformat:2 }}</span></td>
			<td><span id="netgain" class="diff">{{ totalfour | floatformat:2 }}</span></td>
		</tr>
	</tbody>
</table>
{% endblock %}
